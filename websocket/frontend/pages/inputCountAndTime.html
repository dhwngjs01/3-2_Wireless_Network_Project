<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <title>목표 입력 페이지</title>
    <link href="https://fonts.googleapis.com/css?family=Inter&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="../css/common.css" />
    <link rel="stylesheet" href="../css/inputCountAndTime.css" />
  </head>

  <body>
    <div class="container">
      <div class="row">
        <form id="goalForm" method="get" action="">
          <div class="form-group">
            <label for="goalCount">목표 횟수 입력:</label>
            <input type="number" id="goalCount" name="goalCount" value="20" />
            <label for="goalCount">회</label>
          </div>
          <div class="form-group">
            <label for="goalMin">목표 시간 입력:</label>
            <input type="number" id="goalSec" name="goalSec" value="0" min="0" max="300" />
            <label for="goalSec">초</label>
            <label id="timeValue"></label>
          </div>
          <div class="form-group">
            <label for="goalMin">유저 이름 입력:</label>
            <input type="text" id="username" name="username" value="" />
          </div>
          <div class="form-group">
            <button class="start" type="submit">시작</button>
          </div>
        </form>
        <div class="rank">
          <a id="rankLink" href="#" title="순위 보기">
            <img src="../images/rank.png" alt="순위 보기" />
            <span>순위 보기</span>
          </a>
        </div>
      </div>
    </div>
    <script>
      const param = new URLSearchParams(window.location.search);

      const exercise = param.get("exercise");
      const goalForm = document.getElementById("goalForm");
      const goalCount = document.getElementById("goalCount");
      const goalSec = document.getElementById("goalSec");
      const timeValue = document.getElementById("timeValue");
      const usernameInput = document.getElementById("username");

      var calMin = 0
      var calSec = 0
      goalSec.addEventListener("input", function () {
        // input 요소의 값이 변경될 때마다 timeValue에 innerHTML로 표시
        calMin = Math.floor(goalSec.value/60);
        calSec = goalSec.value-(calMin*60);

        timeValue.innerHTML = `(${calMin}분 ${calSec}초)`;
      });

      goalForm.addEventListener("submit", function (event) {
        event.preventDefault();

        const goalCountValue = parseInt(goalCount.value);
        const goalSecValue = parseInt(goalSec.value);
        const usernameValue = usernameInput.value;

        if (isNaN(goalCountValue) || isNaN(goalSecValue)) {
          alert("모든 값을 입력해주세요.");
          return;
        }

        const goalTime = goalSecValue;

        if (goalTime <= 0) {
          alert("목표 시간을 30초 이상으로 설정해주세요.");
          return;
        }

        if (goalCountValue < 0 || goalSecValue < 0) {
          alert("모든 값을 양수로 입력해주세요.");
          return;
        }

        // 페이지 이동
        window.location.href = `./exercise.html?exercise=${exercise}&goalCount=${goalCountValue}&goalTime=${goalTime}&&username=${usernameInput.value}`;
      });

      var exe = exercise
      rankLink.addEventListener("click", function (event) {
        event.preventDefault(); // Prevent the default behavior (link navigation)

        let inputValue;

        // Keep prompting until a valid numeric value is entered
        do {
          inputValue = window.prompt(`${exe}의 순위입니다. 보고싶은 시간대를 입력해주세요.(범위:0초~30초)`);

          // Check if the user clicked Cancel
          if (inputValue === null) {
            return; // Exit the function if Cancel is clicked
          }

          // Check if the entered value is a valid number within the specified range
          inputValue = parseFloat(inputValue);
        } while (isNaN(inputValue) || inputValue < 0 || inputValue > 300);

        // URL parameter extraction
        const param = new URLSearchParams(window.location.search);
        const exercise = param.get("exercise");

        // Update the resultPageURL with the validated user input
        const resultPageURL = `./resultPage.html?exercise=${exercise}&goalTime=${inputValue}`;

        // Redirect to the new URL
        window.location.href = resultPageURL;
      });


      usernameInput.addEventListener("input", function () {
        usernameInput.value = usernameInput.value.replace(/[^a-zA-Z]/g, "").slice(0, 3);
      });
    </script>
  </body>
</html>
